import{_ as u}from"./plugin-vue_export-helper-c27b6911.js";import{r as c,o as r,c as d,a as n,b as s,e as a,d as k,w as e,f as l}from"./app-9f846748.js";const g="/assets/meme-01-840c609e.jpg",m="/assets/2023-08-21-01-9310ca41.png",v={},h=n("h1",{id:"在-laravel-使用-headless-chrome-輸出-pdf",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#在-laravel-使用-headless-chrome-輸出-pdf","aria-hidden":"true"},"#"),s(" 在 Laravel 使用 Headless Chrome 輸出 PDF")],-1),b=n("h2",{id:"前言",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#前言","aria-hidden":"true"},"#"),s(" 前言")],-1),_=n("p",null,[s("使用 Laravel 進行開發，免不了會有一些文件報表套印的功能，"),n("br"),s(" 例如電商網站會需要列印訂單、公司內部系統需要銷售統計報表等等......")],-1),f={href:"https://developer.chrome.com/blog/headless-chrome/",target:"_blank",rel:"noopener noreferrer"},q={href:"https://github.com/chrome-php/chrome",target:"_blank",rel:"noopener noreferrer"},w=n("br",null,null,-1),C=n("h3",{id:"常見解決方案",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#常見解決方案","aria-hidden":"true"},"#"),s(" 常見解決方案")],-1),x={href:"https://www.google.com/search?q=Laravel+PDF",target:"_blank",rel:"noopener noreferrer"},y=n("br",null,null,-1),H={href:"https://github.com/mpdf/mpdf",target:"_blank",rel:"noopener noreferrer"},P={href:"https://github.com/dompdf/dompdf",target:"_blank",rel:"noopener noreferrer"},$={href:"https://github.com/barryvdh/laravel-dompdf",target:"_blank",rel:"noopener noreferrer"},S={href:"https://github.com/barryvdh/laravel-snappy",target:"_blank",rel:"noopener noreferrer"},D=n("p",null,[s("既然有這麼多套件可以幫助，為什麼還要寫個文章呢？"),n("br"),s(" 為了混分 XD")],-1),B=n("h3",{id:"業務場景問題",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#業務場景問題","aria-hidden":"true"},"#"),s(" 業務場景問題")],-1),F=n("code",null,"mpdf",-1),R={href:"https://github.com/mpdf/mpdf#about-css-support-and-development-state",target:"_blank",rel:"noopener noreferrer"},V=l("<p>一言以蔽之：套件舊了，對於瀏覽器的新樣式支援跟不上了。</p><p><code>dompdf</code> 官方文件寫了這句：</p><blockquote><p>Handles most CSS 2.1 and a few CSS3 properties, including @import, @media &amp; @page rules</p></blockquote><p>重點就是這個 <code>few CSS3</code>。</p><p>(所以我說那個樣式呢？)</p><p><code>laravel-dompdf</code> 是基於 dompdf 的再封裝，也會有樣式支援不足的問題。</p><p><code>laravel-snappy</code> 是透過 QT Webkit 渲染引擎來輸出 PDF，<br> 但是 QT Webkit 與目前主流的瀏覽器引擎不同。</p><p>QT Webkit 是基於開源的 WebKit 引擎開發，<br> QtWebEngine 則是基於 Chromium 的 Blink 引擎，<br> 所以在渲染結果上會出現誤差的可能。</p>",8),W={href:"https://www.qt.io/zh-cn/blog/2013/09/25/introducing-the-qt-webengine",target:"_blank",rel:"noopener noreferrer"},A=l('<p>如果文件的樣式不複雜，或是使用者對於誤差的容忍度高，那麼使用上述的方案固然沒問題；<br> 反之，上述的套件受限於 CSS 版本，在文件的設計與測試上會花費許多時間做調整。</p><h3 id="headless-chrome-介紹" tabindex="-1"><a class="header-anchor" href="#headless-chrome-介紹" aria-hidden="true">#</a> Headless Chrome 介紹</h3><p>看看官方文件怎麼說：</p><blockquote><p>Headless Chrome is shipping in Chrome 59. It&#39;s a way to run the Chrome browser in a headless environment</p></blockquote><p>其實就是用命令列執行 Chrome 瀏覽器的功能，<br> 可用於執行網頁測試、列印、截圖等功能。</p><div class="hint-container info"><p class="hint-container-title">版本資訊</p><p>從 Chrome 59 就包含了 Headless Chrome ，支援 Mac 和 Linux 作業系統。<br> 從 Chrome 60 則是跟進支援 Windows 作業系統。</p></div><h2 id="安裝套件" tabindex="-1"><a class="header-anchor" href="#安裝套件" aria-hidden="true">#</a> 安裝套件</h2>',7),L={href:"https://github.com/chrome-php/chrome",target:"_blank",rel:"noopener noreferrer"},N=n("br",null,null,-1),T=n("h3",{id:"先決條件",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#先決條件","aria-hidden":"true"},"#"),s(" 先決條件")],-1),I=n("ul",null,[n("li",null,"PHP 7.4-8.2。"),n("li",null,"安裝 Chrome。")],-1),E=n("h3",{id:"安裝-chrome-瀏覽器",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#安裝-chrome-瀏覽器","aria-hidden":"true"},"#"),s(" 安裝 Chrome 瀏覽器")],-1),O=n("p",null,"這裡列出三種開發環境的安裝方式。",-1),Q=n("p",null,"這個應該最簡單了吧 XD",-1),z={href:"https://www.google.com/intl/zh-TW/chrome/",target:"_blank",rel:"noopener noreferrer"},G=n("figure",null,[n("img",{src:g,alt:"就算死了還是要拿出來鞭",tabindex:"0",loading:"lazy"}),n("figcaption",{style:{"font-size":"1rem"}},"就算死了還是要拿出來鞭")],-1),U=n("p",null,[s("以作業系統 Ubuntu 22.04 為例，"),n("br"),s(" 如果是桌面版本的就跟 Windows 的方式一樣。"),n("br"),s(" 但是如果只有文字介面可參考以下安裝方式。")],-1),K=n("p",null,"更新套件列表",-1),M=n("div",{class:"language-bash line-numbers-mode","data-ext":"sh"},[n("pre",{class:"language-bash"},[n("code",null,[n("span",{class:"token function"},"sudo"),s(),n("span",{class:"token function"},"apt"),s(` update
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"})])],-1),X=n("p",null,"下載 Chrome 穩定版本",-1),j=n("div",{class:"language-bash line-numbers-mode","data-ext":"sh"},[n("pre",{class:"language-bash"},[n("code",null,[n("span",{class:"token function"},"wget"),s(` https://dl.google.com/linux/direct/google-chrome-stable_current_amd64.deb
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"})])],-1),Y=n("p",null,"安裝 Chrome",-1),J=n("div",{class:"language-bash line-numbers-mode","data-ext":"sh"},[n("pre",{class:"language-bash"},[n("code",null,[n("span",{class:"token function"},"sudo"),s(),n("span",{class:"token function"},"apt"),s(),n("span",{class:"token function"},"install"),s(` ./google-chrome-stable_current_amd64.deb
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"})])],-1),Z=n("p",null,"加入 gpg 金鑰",-1),nn=n("div",{class:"language-bash line-numbers-mode","data-ext":"sh"},[n("pre",{class:"language-bash"},[n("code",null,[n("span",{class:"token function"},"wget"),s(),n("span",{class:"token parameter variable"},"-q"),s(),n("span",{class:"token parameter variable"},"-O"),s(" - https://dl.google.com/linux/linux_signing_key.pub "),n("span",{class:"token operator"},"|"),s(),n("span",{class:"token function"},"sudo"),s(" gpg "),n("span",{class:"token parameter variable"},"--dearmour"),s(),n("span",{class:"token parameter variable"},"-o"),s(` /usr/share/keyrings/google_linux_signing_key.gpg
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"})])],-1),sn=n("p",null,"加入 Chrome 套件庫",-1),an=n("div",{class:"language-bash line-numbers-mode","data-ext":"sh"},[n("pre",{class:"language-bash"},[n("code",null,[n("span",{class:"token function"},"sudo"),s(),n("span",{class:"token function"},"sh"),s(),n("span",{class:"token parameter variable"},"-c"),s(),n("span",{class:"token string"},`'echo "deb [arch=amd64 signed-by=/usr/share/keyrings/google_linux_signing_key.gpg] http://dl.google.com/linux/chrome/deb/ stable main" > /etc/apt/sources.list.d/google.list'`),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"})])],-1),tn=n("p",null,"更新套件列表",-1),en=n("div",{class:"language-bash line-numbers-mode","data-ext":"sh"},[n("pre",{class:"language-bash"},[n("code",null,[n("span",{class:"token function"},"sudo"),s(),n("span",{class:"token function"},"apt"),s(` update
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"})])],-1),pn=n("p",null,"下載 Chrome 穩定版本",-1),on=n("div",{class:"language-bash line-numbers-mode","data-ext":"sh"},[n("pre",{class:"language-bash"},[n("code",null,[n("span",{class:"token function"},"sudo"),s(),n("span",{class:"token function"},"apt"),s(),n("span",{class:"token function"},"install"),s(` google-chrome-stable
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"})])],-1),ln=n("p",null,"這個坑比較多......",-1),cn={href:"https://laravel.com/docs/10.x#getting-started-on-linux",target:"_blank",rel:"noopener noreferrer"},un=n("br",null,null,-1),rn=n("p",null,[s("首先要先進入跑 Laravel 的容器再安裝 Chrome，"),n("br"),s(" 這樣才能正確執行到 Headless Chrome。")],-1),dn=n("p",null,"更新套件列表",-1),kn=n("div",{class:"language-bash line-numbers-mode","data-ext":"sh"},[n("pre",{class:"language-bash"},[n("code",null,[n("span",{class:"token function"},"apt"),s(` update
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"})])],-1),gn=n("p",null,"下載 Wget",-1),mn=n("div",{class:"language-bash line-numbers-mode","data-ext":"sh"},[n("pre",{class:"language-bash"},[n("code",null,[n("span",{class:"token function"},"apt"),s(),n("span",{class:"token function"},"install"),s(),n("span",{class:"token function"},"wget"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"})])],-1),vn=n("p",null,"下載 Chrome 穩定版本",-1),hn=n("div",{class:"language-bash line-numbers-mode","data-ext":"sh"},[n("pre",{class:"language-bash"},[n("code",null,[n("span",{class:"token function"},"wget"),s(` https://dl.google.com/linux/direct/google-chrome-stable_current_amd64.deb
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"})])],-1),bn=n("p",null,"安裝 Chrome",-1),_n=n("div",{class:"language-bash line-numbers-mode","data-ext":"sh"},[n("pre",{class:"language-bash"},[n("code",null,[n("span",{class:"token function"},"apt"),s(),n("span",{class:"token function"},"install"),s(` ./google-chrome-stable_current_amd64.deb
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"})])],-1),fn=l(`<h3 id="安裝-chrome-php-套件" tabindex="-1"><a class="header-anchor" href="#安裝-chrome-php-套件" aria-hidden="true">#</a> 安裝 Chrome PHP 套件</h3><p>這個就比較簡單了，用 Composer 安裝就可以了<br> 如果是用 Docker 記得一樣要先進入容器與專案目錄再安裝。</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">composer</span> require chrome-php/chrome
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="使用範例" tabindex="-1"><a class="header-anchor" href="#使用範例" aria-hidden="true">#</a> 使用範例</h2><p>這裡展示 Laravel 基本 MVC 的作法，<br> 使用 Bootstrap 5 來作為簡單的使用範例。</p><h3 id="新增-view" tabindex="-1"><a class="header-anchor" href="#新增-view" aria-hidden="true">#</a> 新增 View</h3><p>直接用 Bootstrap 5 的一些表單元件做測試，<br> 如果要用自己的 CSS 樣式，<br> 可參考 Laravel 官方教學的靜態資源引用。</p><p><code>resources/views/report/test.blade.php</code></p><div class="language-html line-numbers-mode" data-ext="html"><pre class="language-html"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>utf-8<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>viewport<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>width=device-width, initial-scale=1<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Bootstrap demo<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span>
      <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css<span class="token punctuation">&quot;</span></span>
      <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>stylesheet<span class="token punctuation">&quot;</span></span>
      <span class="token attr-name">integrity</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9<span class="token punctuation">&quot;</span></span>
      <span class="token attr-name">crossorigin</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>anonymous<span class="token punctuation">&quot;</span></span>
    <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>

  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>container-md<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>Hello, world!<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>

      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>table<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>thead</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span> <span class="token attr-name">scope</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>col<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Class<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span> <span class="token attr-name">scope</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>col<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Heading<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span> <span class="token attr-name">scope</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>col<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Heading<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>thead</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tbody</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span> <span class="token attr-name">scope</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>row<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Default<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span>Cell<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span>Cell<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">&gt;</span></span>

          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>table-primary<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span> <span class="token attr-name">scope</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>row<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Primary<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span>Cell<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span>Cell<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">&gt;</span></span>

          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>table-success<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span> <span class="token attr-name">scope</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>row<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Success<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span>Cell<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span>Cell<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>table-danger<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span> <span class="token attr-name">scope</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>row<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Danger<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span>Cell<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span>Cell<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tbody</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>table</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>{{ route(&#39;download&#39;) }}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>button<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>btn btn-primary<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>印出來<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="新增-controller" tabindex="-1"><a class="header-anchor" href="#新增-controller" aria-hidden="true">#</a> 新增 Controller</h3><p>新增兩個方法，一個用於展示畫面，一個用於輸出檔案。</p><p><code>app/Http/Controllers/ReportController.php</code></p><div class="language-php line-numbers-mode" data-ext="php"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\\</span>Http<span class="token punctuation">\\</span>Controllers</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\\</span>Http<span class="token punctuation">\\</span>Request</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\\</span>Support<span class="token punctuation">\\</span>Str</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\\</span>View<span class="token punctuation">\\</span>View</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">HeadlessChromium<span class="token punctuation">\\</span>BrowserFactory</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name-definition class-name">ReportController</span> <span class="token keyword">extends</span> <span class="token class-name">Controller</span>
<span class="token punctuation">{</span>
    <span class="token doc-comment comment">/**
     * 顯示文件畫面
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token class-name return-type">View</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">view</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;report.test&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * 透過 Headless Chrome  產出 PDF
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">download</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// 產生 Blade 引擎渲染後的 HTML 字串</span>
        <span class="token variable">$render</span> <span class="token operator">=</span> <span class="token function">view</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;report.test&#39;</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$browserFactory</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BrowserFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 如果在容器中使用要加入這段</span>
        <span class="token variable">$browserOptions</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string single-quoted-string">&#39;noSandbox&#39;</span> <span class="token operator">=&gt;</span> <span class="token constant boolean">true</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token variable">$browser</span> <span class="token operator">=</span> <span class="token variable">$browserFactory</span><span class="token operator">-&gt;</span><span class="token function">createBrowser</span><span class="token punctuation">(</span><span class="token variable">$browserOptions</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$page</span> <span class="token operator">=</span> <span class="token variable">$browser</span><span class="token operator">-&gt;</span><span class="token function">createPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$page</span><span class="token operator">-&gt;</span><span class="token function">setHtml</span><span class="token punctuation">(</span><span class="token variable">$render</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 列印頁面設定</span>
        <span class="token variable">$pageOptions</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
            <span class="token string single-quoted-string">&#39;marginTop&#39;</span> <span class="token operator">=&gt;</span> <span class="token number">0.0</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">&#39;marginBottom&#39;</span> <span class="token operator">=&gt;</span> <span class="token number">0.0</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">&#39;marginLeft&#39;</span> <span class="token operator">=&gt;</span> <span class="token number">0.0</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">&#39;marginRight&#39;</span> <span class="token operator">=&gt;</span> <span class="token number">0.0</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">&#39;paperWidth&#39;</span> <span class="token operator">=&gt;</span> <span class="token number">8.3</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">&#39;paperHeight&#39;</span> <span class="token operator">=&gt;</span> <span class="token number">11.7</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">&#39;printBackground&#39;</span> <span class="token operator">=&gt;</span> <span class="token constant boolean">true</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token comment">// 產生隨機檔名並存放於暫存資料夾</span>
        <span class="token variable">$random</span> <span class="token operator">=</span> <span class="token class-name static-context">Str</span><span class="token operator">::</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$savePath</span> <span class="token operator">=</span> <span class="token function">storage_path</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;temp&#39;</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token string single-quoted-string">&#39;/&#39;</span> <span class="token operator">.</span> <span class="token variable">$random</span> <span class="token operator">.</span> <span class="token string single-quoted-string">&#39;.pdf&#39;</span><span class="token punctuation">;</span>
        <span class="token variable">$pdf</span> <span class="token operator">=</span> <span class="token variable">$page</span><span class="token operator">-&gt;</span><span class="token function">pdf</span><span class="token punctuation">(</span><span class="token variable">$pageOptions</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$pdf</span><span class="token operator">-&gt;</span><span class="token function">saveToFile</span><span class="token punctuation">(</span><span class="token variable">$savePath</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$downloadName</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;<span class="token interpolation"><span class="token punctuation">{</span><span class="token variable">$random</span><span class="token punctuation">}</span></span>.pdf&quot;</span><span class="token punctuation">;</span>
        <span class="token comment">// 下載檔案</span>
        <span class="token variable">$response</span> <span class="token operator">=</span> <span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">download</span><span class="token punctuation">(</span><span class="token variable">$savePath</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$response</span><span class="token operator">-&gt;</span><span class="token property">headers</span><span class="token operator">-&gt;</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;content-disposition&#39;</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">&quot;attachment; filename=<span class="token interpolation"><span class="token punctuation">{</span><span class="token variable">$downloadName</span><span class="token punctuation">}</span></span>&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token variable">$response</span><span class="token operator">-&gt;</span><span class="token function">deleteFileAfterSend</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="新增-route" tabindex="-1"><a class="header-anchor" href="#新增-route" aria-hidden="true">#</a> 新增 Route</h3><p><code>routes/web.php</code></p><div class="language-php line-numbers-mode" data-ext="php"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\\</span>Support<span class="token punctuation">\\</span>Facades<span class="token punctuation">\\</span>Route</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\\</span>Http<span class="token punctuation">\\</span>Controllers<span class="token punctuation">\\</span>ReportController</span><span class="token punctuation">;</span>

<span class="token class-name static-context">Route</span><span class="token operator">::</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;/&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">view</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;welcome&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name static-context">Route</span><span class="token operator">::</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;/report/show&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token class-name static-context">ReportController</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">&#39;show&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name static-context">Route</span><span class="token operator">::</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;/report/download&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token class-name static-context">ReportController</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">&#39;download&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;download&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="畫面展示" tabindex="-1"><a class="header-anchor" href="#畫面展示" aria-hidden="true">#</a> 畫面展示</h3><p>輸入顯示畫面的網址，就可以看到測試的畫面了。<br> 畫面出現之後可以點選右上角的列印功能，<br> 上面的 <code>pageOptions</code> 陣列就是對應列印功能選項。</p><figure><img src="`+m+'" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>原則上客戶端的列印選項一樣，那麼伺服器輸出的檔案就會一樣。</p>',20),qn={href:"https://github.com/chrome-php/chrome#print-as-pdf",target:"_blank",rel:"noopener noreferrer"},wn=n("h2",{id:"參考資料",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#參考資料","aria-hidden":"true"},"#"),s(" 參考資料")],-1),Cn={href:"https://github.com/chrome-php/chrome",target:"_blank",rel:"noopener noreferrer"},xn=n("br",null,null,-1),yn={href:"https://developer.chrome.com/blog/headless-chrome/",target:"_blank",rel:"noopener noreferrer"};function Hn(Pn,$n){const t=c("ExternalLinkIcon"),i=c("Tabs");return r(),d("div",null,[h,b,_,n("p",null,[s("本篇教學會使用 "),n("a",f,[s("Headless Chrome"),a(t)]),s(" 與 "),n("a",q,[s("Chrome PHP"),a(t)]),s(" 來產生 PDF 檔案，"),w,s(" 也會附上一些踩坑心得與解決方法。")]),k(" more "),C,n("p",null,[s("當聽到 PDF 檔案產製的需求一般都是直接 "),n("a",x,[s("Google"),a(t)]),y,s(" 比較常看到的解決方案大概如下：")]),n("ul",null,[n("li",null,[n("a",H,[s("mpdf"),a(t)])]),n("li",null,[n("a",P,[s("dompdf"),a(t)])]),n("li",null,[n("a",$,[s("laravel-dompdf"),a(t)])]),n("li",null,[n("a",S,[s("laravel-snappy"),a(t)])])]),D,B,n("p",null,[F,s(" 的官方文件 "),n("a",R,[s("About CSS support and development state"),a(t)]),s(" 給出了答案。")]),V,n("p",null,[n("a",W,[s("Introducing the Qt WebEngine"),a(t)])]),A,n("p",null,[s("本次要使用的套件為 "),n("a",L,[s("Chrome PHP"),a(t)]),s("。"),N,s(" 主要是把執行 Headless Chrome 的指令進行封裝，省下自己寫指令的麻煩。")]),T,I,E,O,a(i,{id:"128",data:[{id:"Windows"},{id:"Ubuntu 直接下載安裝"},{id:"Ubuntu 官方套件安裝"},{id:"Docker"}]},{title0:e(({value:p,isActive:o})=>[s("Windows")]),title1:e(({value:p,isActive:o})=>[s("Ubuntu 直接下載安裝")]),title2:e(({value:p,isActive:o})=>[s("Ubuntu 官方套件安裝")]),title3:e(({value:p,isActive:o})=>[s("Docker")]),tab0:e(({value:p,isActive:o})=>[Q,n("p",null,[n("a",z,[s("Google Chrome 網路瀏覽器"),a(t)]),s(" 點進去下載安裝")]),G]),tab1:e(({value:p,isActive:o})=>[U,K,M,X,j,Y,J]),tab2:e(({value:p,isActive:o})=>[Z,nn,sn,an,tn,en,pn,on]),tab3:e(({value:p,isActive:o})=>[ln,n("p",null,[s("如果是參考官方教學文件的方式 "),n("a",cn,[s("Getting Started On Linux"),a(t)]),un,s(" 由於容器中的環境都是被隔離的，所以裝在作業系統是沒有用的。")]),rn,dn,kn,gn,mn,vn,hn,bn,_n]),_:1}),fn,n("p",null,[s("詳細可用的設定可以參考官方文件 "),n("a",qn,[s("Print as PDF"),a(t)]),s("。")]),wn,n("p",null,[n("a",Cn,[s("Chrome PHP"),a(t)]),xn,n("a",yn,[s("Getting Started with Headless Chrome"),a(t)])])])}const Bn=u(v,[["render",Hn],["__file","index.html.vue"]]);export{Bn as default};
