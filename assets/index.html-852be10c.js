import{_ as o}from"./plugin-vue_export-helper-c27b6911.js";import{r as d,o as u,c as p,a as n,b as a,e as t,d as g,w as e,f as l}from"./app-e83228cf.js";const h="/assets/meme-01-ad4e18c2.png",b={},v=n("h1",{id:"在-ubuntu-安裝-nginx-伺服器-官網-nginx-安裝",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#在-ubuntu-安裝-nginx-伺服器-官網-nginx-安裝","aria-hidden":"true"},"#"),a(" 在 Ubuntu 安裝 Nginx 伺服器（官網 Nginx 安裝）")],-1),m=n("h2",{id:"前言",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#前言","aria-hidden":"true"},"#"),a(" 前言")],-1),x={href:"https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-23017",target:"_blank",rel:"noopener noreferrer"},k=n("br",null,null,-1),f=n("br",null,null,-1),_=n("p",null,[a("本文章會在 Ubuntu 22.04 透過官方的 APT 套件庫安裝 Nginx 伺服器，"),n("br"),a(" 並簡單介紹使用設定說明。")],-1),y=n("figure",null,[n("img",{src:h,alt:"這樣會出事的！",tabindex:"0",loading:"lazy"}),n("figcaption",{style:{"font-size":"1rem"}},"這樣會出事的！")],-1),N=l(`<h2 id="安裝-nginx" tabindex="-1"><a class="header-anchor" href="#安裝-nginx" aria-hidden="true">#</a> 安裝 Nginx</h2><h3 id="安裝必備套件" tabindex="-1"><a class="header-anchor" href="#安裝必備套件" aria-hidden="true">#</a> 安裝必備套件</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> <span class="token function">curl</span> gnupg2 ca-certificates lsb-release ubuntu-keyring
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="導入官方-nginx-簽名密鑰以便-apt-可以驗證套件的真實性。" tabindex="-1"><a class="header-anchor" href="#導入官方-nginx-簽名密鑰以便-apt-可以驗證套件的真實性。" aria-hidden="true">#</a> 導入官方 Nginx 簽名密鑰以便 APT 可以驗證套件的真實性。</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">curl</span> https://nginx.org/keys/nginx_signing.key <span class="token operator">|</span> gpg <span class="token parameter variable">--dearmor</span> <span class="token punctuation">\\</span>
    <span class="token operator">|</span> <span class="token function">sudo</span> <span class="token function">tee</span> /usr/share/keyrings/nginx-archive-keyring.gpg <span class="token operator">&gt;</span>/dev/null
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="驗證下載的文件是否包含正確的密鑰" tabindex="-1"><a class="header-anchor" href="#驗證下載的文件是否包含正確的密鑰" aria-hidden="true">#</a> 驗證下載的文件是否包含正確的密鑰</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>gpg --dry-run <span class="token parameter variable">--quiet</span> --no-keyring <span class="token parameter variable">--import</span> --import-options import-show /usr/share/keyrings/nginx-archive-keyring.gpg
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="輸出應包含完整指紋" tabindex="-1"><a class="header-anchor" href="#輸出應包含完整指紋" aria-hidden="true">#</a> 輸出應包含完整指紋</h3><p>這個是輸出驗證結果畫面的範例，不是要打進終端機的。</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>pub   rsa2048 <span class="token number">2011</span>-08-19 <span class="token punctuation">[</span>SC<span class="token punctuation">]</span> <span class="token punctuation">[</span>expires: <span class="token number">2024</span>-06-14<span class="token punctuation">]</span>
      573BFD6B3D8FBC641079A6ABABF5BD827BD9BF62
uid                      nginx signing key <span class="token operator">&lt;</span>signing-key@nginx.com
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="選擇安裝的版本" tabindex="-1"><a class="header-anchor" href="#選擇安裝的版本" aria-hidden="true">#</a> 選擇安裝的版本</h3><p>選一個版本輸入就好，建議是穩定版本。</p>`,12),P=n("div",{class:"language-bash line-numbers-mode","data-ext":"sh"},[n("pre",{class:"language-bash"},[n("code",null,[n("span",{class:"token builtin class-name"},"echo"),a(),n("span",{class:"token string"},[a(`"deb [signed-by=/usr/share/keyrings/nginx-archive-keyring.gpg] \\
http://nginx.org/packages/ubuntu `),n("span",{class:"token variable"},[n("span",{class:"token variable"},"`"),a("lsb_release "),n("span",{class:"token parameter variable"},"-cs"),n("span",{class:"token variable"},"`")]),a(' nginx"')]),a(),n("span",{class:"token punctuation"},"\\"),a(`
    `),n("span",{class:"token operator"},"|"),a(),n("span",{class:"token function"},"sudo"),a(),n("span",{class:"token function"},"tee"),a(` /etc/apt/sources.list.d/nginx.list
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),j=n("div",{class:"language-bash line-numbers-mode","data-ext":"sh"},[n("pre",{class:"language-bash"},[n("code",null,[n("span",{class:"token builtin class-name"},"echo"),a(),n("span",{class:"token string"},[a(`"deb [signed-by=/usr/share/keyrings/nginx-archive-keyring.gpg] \\
http://nginx.org/packages/mainline/ubuntu `),n("span",{class:"token variable"},[n("span",{class:"token variable"},"`"),a("lsb_release "),n("span",{class:"token parameter variable"},"-cs"),n("span",{class:"token variable"},"`")]),a(' nginx"')]),a(),n("span",{class:"token punctuation"},"\\"),a(`
    `),n("span",{class:"token operator"},"|"),a(),n("span",{class:"token function"},"sudo"),a(),n("span",{class:"token function"},"tee"),a(` /etc/apt/sources.list.d/nginx.list
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),q=l(`<h3 id="安裝上方選定的版本" tabindex="-1"><a class="header-anchor" href="#安裝上方選定的版本" aria-hidden="true">#</a> 安裝上方選定的版本</h3><p>就是上面自己選的其中一個版本。</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">apt</span> update
<span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> nginx
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="安裝指定號碼的版本" tabindex="-1"><a class="header-anchor" href="#安裝指定號碼的版本" aria-hidden="true">#</a> 安裝指定號碼的版本</h3><p>如果有偏好選定的版本可以用這方式來安裝。</p><p>顯示所有可選安裝的版本</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">apt-cache</span> madison nginx
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>會出現類似下方的列表</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>     nginx <span class="token operator">|</span> <span class="token number">1.24</span>.0-1~jammy <span class="token operator">|</span> http://nginx.org/packages/ubuntu jammy/nginx amd64 Packages
     nginx <span class="token operator">|</span> <span class="token number">1.22</span>.1-1~jammy <span class="token operator">|</span> http://nginx.org/packages/ubuntu jammy/nginx amd64 Packages
     nginx <span class="token operator">|</span> <span class="token number">1.22</span>.0-1~jammy <span class="token operator">|</span> http://nginx.org/packages/ubuntu jammy/nginx amd64 Packages
     nginx <span class="token operator">|</span> <span class="token number">1.20</span>.2-1~jammy <span class="token operator">|</span> http://nginx.org/packages/ubuntu jammy/nginx amd64 Packages
     nginx <span class="token operator">|</span> <span class="token number">1.18</span>.0-6ubuntu14.3 <span class="token operator">|</span> http://tw.archive.ubuntu.com/ubuntu jammy-updates/main amd64 Packages
     nginx <span class="token operator">|</span> <span class="token number">1.18</span>.0-6ubuntu14.3 <span class="token operator">|</span> http://security.ubuntu.com/ubuntu jammy-security/main amd64 Packages
     nginx <span class="token operator">|</span> <span class="token number">1.18</span>.0-6ubuntu14 <span class="token operator">|</span> http://tw.archive.ubuntu.com/ubuntu jammy/main amd64 Packages
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>後面加上列表版本</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">apt</span> update
<span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> <span class="token assign-left variable">nginx</span><span class="token operator">=</span><span class="token number">1.22</span>.1-1~jammy
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="設定優先使用-nginx-官方來源取代-apt-套件庫" tabindex="-1"><a class="header-anchor" href="#設定優先使用-nginx-官方來源取代-apt-套件庫" aria-hidden="true">#</a> 設定優先使用 Nginx 官方來源取代 APT 套件庫</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token builtin class-name">echo</span> <span class="token parameter variable">-e</span> <span class="token string">&quot;Package: *<span class="token entity" title="\\n">\\n</span>Pin: origin nginx.org<span class="token entity" title="\\n">\\n</span>Pin: release o=nginx<span class="token entity" title="\\n">\\n</span>Pin-Priority: 900<span class="token entity" title="\\n">\\n</span>&quot;</span> <span class="token punctuation">\\</span>
    <span class="token operator">|</span> <span class="token function">sudo</span> <span class="token function">tee</span> /etc/apt/preferences.d/99nginx
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="設定-nginx" tabindex="-1"><a class="header-anchor" href="#設定-nginx" aria-hidden="true">#</a> 設定 Nginx</h2><h3 id="重大改動" tabindex="-1"><a class="header-anchor" href="#重大改動" aria-hidden="true">#</a> 重大改動</h3><ul><li>nginx 1.20 之後不再使用 <code>/etc/nginx/site-enabled</code> 底下的設定</li><li>新的 nginx 預設使用 <code>nginx</code> 作為 user 名稱，取代原本的 <code>www-data</code></li></ul><h3 id="網站設定" tabindex="-1"><a class="header-anchor" href="#網站設定" aria-hidden="true">#</a> 網站設定</h3><p>因為 <code>nginx.conf</code> 改為直接從 <code>conf.d</code> 讀取 <code>*.conf</code> 的設定檔案<br> 所以設定直接寫在裡面就好，建議備份設定。</p><p>如果還是想用以前版本使用 <code>/etc/nginx/site-enabled</code> 的設定方式，<br> 就必須開啟 <code>/etc/nginx/nginx.conf</code> 手動修改加入。<br> 以下為片段修改的範例：</p><div class="language-conf line-numbers-mode" data-ext="conf"><pre class="language-conf"><code>user  nginx;
worker_processes  auto;

error_log  /var/log/nginx/error.log notice;
pid        /var/run/nginx.pid;


events {
    worker_connections  1024;
}


http {
    include       /etc/nginx/mime.types;
    default_type  application/octet-stream;

    log_format  main  &#39;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#39;
                      &#39;$status $body_bytes_sent &quot;$http_referer&quot; &#39;
                      &#39;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#39;;

    access_log  /var/log/nginx/access.log  main;

    sendfile        on;
    #tcp_nopush     on;

    keepalive_timeout  65;

    #gzip  on;

    include /etc/nginx/conf.d/*.conf;
    # 加上這行
    include /etc/nginx/sites-enabled/*;
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="權限設定" tabindex="-1"><a class="header-anchor" href="#權限設定" aria-hidden="true">#</a> 權限設定</h3><p>如果 <code>/var/log/nginx/error.log</code> 出現 (13: permission denied) 的錯誤訊息<br> 代表 nginx 無法正常 cd 至專案目錄<br> 解決方法參考如下：</p><p>根據 <code>/etc/nginx/nginx.conf</code> 設定，<br> Nginx 預設使用者名稱為 <code>nginx</code>，<br> 故需要將指定使用者加入 nginx 群組。</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># username 是自己主機使用者名稱，請根據自己的主機名稱調整</span>
<span class="token function">sudo</span> gpasswd <span class="token parameter variable">-a</span> nginx username
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>並確保用戶群組可以進入路徑中的所有目錄</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">chmod</span> g+x /home/username <span class="token operator">&amp;&amp;</span> <span class="token function">chmod</span> g+x /home/username/test
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>設定完畢後重啟伺服器</p><h3 id="確認-nginx-是否連接成功" tabindex="-1"><a class="header-anchor" href="#確認-nginx-是否連接成功" aria-hidden="true">#</a> 確認 Nginx 是否連接成功</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">sudo</span> nginx <span class="token parameter variable">-t</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="得到這個消息後便可重啟-nginx" tabindex="-1"><a class="header-anchor" href="#得到這個消息後便可重啟-nginx" aria-hidden="true">#</a> 得到這個消息後便可重啟 Nginx</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>nginx: the configuration <span class="token function">file</span> /etc/nginx/nginx.conf syntax is ok
nginx: configuration <span class="token function">file</span> /etc/nginx/nginx.conf <span class="token builtin class-name">test</span> is successful
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="重新讀取-nginx-設定文件" tabindex="-1"><a class="header-anchor" href="#重新讀取-nginx-設定文件" aria-hidden="true">#</a> 重新讀取 Nginx 設定文件</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">service</span> nginx reload
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="重啟-nginx-伺服器" tabindex="-1"><a class="header-anchor" href="#重啟-nginx-伺服器" aria-hidden="true">#</a> 重啟 Nginx 伺服器</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">service</span> nginx restart
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="參考資料" tabindex="-1"><a class="header-anchor" href="#參考資料" aria-hidden="true">#</a> 參考資料</h2>`,36),w={href:"http://nginx.org/en/linux_packages.html",target:"_blank",rel:"noopener noreferrer"};function A(B,C){const r=d("ExternalLinkIcon"),c=d("CodeTabs");return u(),p("div",null,[v,m,n("p",null,[a("由於受到  "),n("a",x,[a("CVE-2021-23017"),t(r)]),a("  漏洞的影響，"),k,a(" Nginx 必須升級到 1.20.1 以上，但由於 Ubuntu 22.04 官方 APT 發行的版本為 1.18。"),f,a(" 故本次教學直接使用 Nginx 官方的安裝指南，取代 Ubuntu 官方 APT 安裝的方式。")]),_,y,g(" more "),N,t(c,{id:"44",data:[{id:"穩定版本"},{id:"主線版本"}],active:0,"tab-id":"shell"},{title0:e(({value:s,isActive:i})=>[a("穩定版本")]),title1:e(({value:s,isActive:i})=>[a("主線版本")]),tab0:e(({value:s,isActive:i})=>[P]),tab1:e(({value:s,isActive:i})=>[j]),_:1}),q,n("p",null,[n("a",w,[a("http://nginx.org/en/linux_packages.html"),t(r)])])])}const V=o(b,[["render",A],["__file","index.html.vue"]]);export{V as default};
