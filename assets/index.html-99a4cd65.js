import{_ as i}from"./plugin-vue_export-helper-c27b6911.js";import{r as t,o as r,c,a as n,b as a,e,f as d}from"./app-5e66abc2.js";const l={},o=n("h1",{id:"nginx-安裝教學",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#nginx-安裝教學","aria-hidden":"true"},"#"),a(" Nginx 安裝教學")],-1),p={href:"https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-23017",target:"_blank",rel:"noopener noreferrer"},u=n("br",null,null,-1),g=d(`<h1 id="安裝-nginx" tabindex="-1"><a class="header-anchor" href="#安裝-nginx" aria-hidden="true">#</a> 安裝 Nginx</h1><h2 id="安裝必備套件" tabindex="-1"><a class="header-anchor" href="#安裝必備套件" aria-hidden="true">#</a> 安裝必備套件</h2><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> <span class="token function">curl</span> gnupg2 ca-certificates lsb-release ubuntu-keyring
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="導入官方-nginx-簽名密鑰以便-apt-可以驗證套件的真實性。" tabindex="-1"><a class="header-anchor" href="#導入官方-nginx-簽名密鑰以便-apt-可以驗證套件的真實性。" aria-hidden="true">#</a> 導入官方 nginx 簽名密鑰以便 apt 可以驗證套件的真實性。</h2><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">curl</span> https://nginx.org/keys/nginx_signing.key <span class="token operator">|</span> gpg <span class="token parameter variable">--dearmor</span> <span class="token punctuation">\\</span>
    <span class="token operator">|</span> <span class="token function">sudo</span> <span class="token function">tee</span> /usr/share/keyrings/nginx-archive-keyring.gpg <span class="token operator">&gt;</span>/dev/null
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="驗證下載的文件是否包含正確的密鑰" tabindex="-1"><a class="header-anchor" href="#驗證下載的文件是否包含正確的密鑰" aria-hidden="true">#</a> 驗證下載的文件是否包含正確的密鑰</h2><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>gpg --dry-run <span class="token parameter variable">--quiet</span> --no-keyring <span class="token parameter variable">--import</span> --import-options import-show /usr/share/keyrings/nginx-archive-keyring.gpg
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="輸出應包含完整指紋" tabindex="-1"><a class="header-anchor" href="#輸出應包含完整指紋" aria-hidden="true">#</a> 輸出應包含完整指紋</h2><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>pub   rsa2048 <span class="token number">2011</span>-08-19 <span class="token punctuation">[</span>SC<span class="token punctuation">]</span> <span class="token punctuation">[</span>expires: <span class="token number">2024</span>-06-14<span class="token punctuation">]</span>
      573BFD6B3D8FBC641079A6ABABF5BD827BD9BF62
uid                      nginx signing key <span class="token operator">&lt;</span>signing-key@nginx.com
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="選擇安裝穩定版本的-nginx" tabindex="-1"><a class="header-anchor" href="#選擇安裝穩定版本的-nginx" aria-hidden="true">#</a> 選擇安裝穩定版本的 nginx</h2><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token builtin class-name">echo</span> <span class="token string">&quot;deb [signed-by=/usr/share/keyrings/nginx-archive-keyring.gpg] \\
http://nginx.org/packages/ubuntu <span class="token variable"><span class="token variable">\`</span>lsb_release <span class="token parameter variable">-cs</span><span class="token variable">\`</span></span> nginx&quot;</span> <span class="token punctuation">\\</span>
    <span class="token operator">|</span> <span class="token function">sudo</span> <span class="token function">tee</span> /etc/apt/sources.list.d/nginx.list
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="選擇安裝主線版本的-nginx" tabindex="-1"><a class="header-anchor" href="#選擇安裝主線版本的-nginx" aria-hidden="true">#</a> 選擇安裝主線版本的 nginx</h2><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token builtin class-name">echo</span> <span class="token string">&quot;deb [signed-by=/usr/share/keyrings/nginx-archive-keyring.gpg] \\
http://nginx.org/packages/mainline/ubuntu <span class="token variable"><span class="token variable">\`</span>lsb_release <span class="token parameter variable">-cs</span><span class="token variable">\`</span></span> nginx&quot;</span> <span class="token punctuation">\\</span>
    <span class="token operator">|</span> <span class="token function">sudo</span> <span class="token function">tee</span> /etc/apt/sources.list.d/nginx.list
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="安裝選定版本的-nginx" tabindex="-1"><a class="header-anchor" href="#安裝選定版本的-nginx" aria-hidden="true">#</a> 安裝選定版本的 nginx</h2><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">apt</span> update
<span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> nginx
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="安裝特定版本的-nginx" tabindex="-1"><a class="header-anchor" href="#安裝特定版本的-nginx" aria-hidden="true">#</a> 安裝特定版本的 nginx</h2><p>顯示所有可選安裝的版本</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">apt-cache</span> madison nginx
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>會出現類似下方的列表</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>     nginx <span class="token operator">|</span> <span class="token number">1.24</span>.0-1~jammy <span class="token operator">|</span> http://nginx.org/packages/ubuntu jammy/nginx amd64 Packages
     nginx <span class="token operator">|</span> <span class="token number">1.22</span>.1-1~jammy <span class="token operator">|</span> http://nginx.org/packages/ubuntu jammy/nginx amd64 Packages
     nginx <span class="token operator">|</span> <span class="token number">1.22</span>.0-1~jammy <span class="token operator">|</span> http://nginx.org/packages/ubuntu jammy/nginx amd64 Packages
     nginx <span class="token operator">|</span> <span class="token number">1.20</span>.2-1~jammy <span class="token operator">|</span> http://nginx.org/packages/ubuntu jammy/nginx amd64 Packages
     nginx <span class="token operator">|</span> <span class="token number">1.18</span>.0-6ubuntu14.3 <span class="token operator">|</span> http://tw.archive.ubuntu.com/ubuntu jammy-updates/main amd64 Packages
     nginx <span class="token operator">|</span> <span class="token number">1.18</span>.0-6ubuntu14.3 <span class="token operator">|</span> http://security.ubuntu.com/ubuntu jammy-security/main amd64 Packages
     nginx <span class="token operator">|</span> <span class="token number">1.18</span>.0-6ubuntu14 <span class="token operator">|</span> http://tw.archive.ubuntu.com/ubuntu jammy/main amd64 Packages
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>後面加上列表版本</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">apt</span> update
<span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> <span class="token assign-left variable">nginx</span><span class="token operator">=</span><span class="token number">1.22</span>.1-1~jammy
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="設置套件庫官方來源取代發行版提供的套件版本" tabindex="-1"><a class="header-anchor" href="#設置套件庫官方來源取代發行版提供的套件版本" aria-hidden="true">#</a> 設置套件庫官方來源取代發行版提供的套件版本：</h2><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token builtin class-name">echo</span> <span class="token parameter variable">-e</span> <span class="token string">&quot;Package: *<span class="token entity" title="\\n">\\n</span>Pin: origin nginx.org<span class="token entity" title="\\n">\\n</span>Pin: release o=nginx<span class="token entity" title="\\n">\\n</span>Pin-Priority: 900<span class="token entity" title="\\n">\\n</span>&quot;</span> <span class="token punctuation">\\</span>
    <span class="token operator">|</span> <span class="token function">sudo</span> <span class="token function">tee</span> /etc/apt/preferences.d/99nginx
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h1 id="設定-nginx" tabindex="-1"><a class="header-anchor" href="#設定-nginx" aria-hidden="true">#</a> 設定 Nginx</h1><h2 id="重大改動" tabindex="-1"><a class="header-anchor" href="#重大改動" aria-hidden="true">#</a> 重大改動</h2><ul><li>因 nginx 1.20 之後不再使用 /etc/nginx/site-enabled 底下的設定</li><li>新的 nginx 使用 nginx 作為 user，取代原本的 www-data</li></ul><h2 id="網站設定" tabindex="-1"><a class="header-anchor" href="#網站設定" aria-hidden="true">#</a> 網站設定</h2><p>因為 <code>nginx.conf</code> 改為直接從 <code>conf.d</code> 讀取 <code>*.conf</code> 的設定檔案<br> 所以設定直接寫在裡面就好，建議備份設定</p><h2 id="權限設定" tabindex="-1"><a class="header-anchor" href="#權限設定" aria-hidden="true">#</a> 權限設定</h2><p>如果 /var/log/nginx/error.log 出現 (13: permission denied) 的錯誤訊息<br> 代表 nginx 無法正常 cd 至專案目錄<br> 解決方法參考如下：</p><p>根據 /etc/nginx/nginx.conf 設定，<br> nginx 預設使用者為 nginx，<br> 故需要將指定使用者加入 nginx 群組。</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">sudo</span> gpasswd <span class="token parameter variable">-a</span> nginx username
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>並確保用戶群組可以進入路徑中的所有目錄</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">chmod</span> g+x /home/username <span class="token operator">&amp;&amp;</span> <span class="token function">chmod</span> g+x /home/username/test
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>設定完畢後重啟伺服器</p><h2 id="確認-nginx-是否連接成功" tabindex="-1"><a class="header-anchor" href="#確認-nginx-是否連接成功" aria-hidden="true">#</a> 確認 Nginx 是否連接成功</h2><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">sudo</span> nginx <span class="token parameter variable">-t</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="得到這個消息後便可重啟-nginx" tabindex="-1"><a class="header-anchor" href="#得到這個消息後便可重啟-nginx" aria-hidden="true">#</a> 得到這個消息後便可重啟 Nginx</h2><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>nginx: the configuration <span class="token function">file</span> /etc/nginx/nginx.conf syntax is ok
nginx: configuration <span class="token function">file</span> /etc/nginx/nginx.conf <span class="token builtin class-name">test</span> is successful
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="重新讀取-nginx-設定文件" tabindex="-1"><a class="header-anchor" href="#重新讀取-nginx-設定文件" aria-hidden="true">#</a> 重新讀取 Nginx 設定文件</h2><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">service</span> nginx reload
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="重啟-nginx-伺服器" tabindex="-1"><a class="header-anchor" href="#重啟-nginx-伺服器" aria-hidden="true">#</a> 重啟 Nginx 伺服器</h2><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">service</span> nginx restart
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h1 id="參考資料" tabindex="-1"><a class="header-anchor" href="#參考資料" aria-hidden="true">#</a> 參考資料</h1>`,45),h={href:"http://nginx.org/en/linux_packages.html",target:"_blank",rel:"noopener noreferrer"};function b(m,v){const s=t("ExternalLinkIcon");return r(),c("div",null,[o,n("p",null,[a("由於受到  "),n("a",p,[a("CVE-2021-23017"),e(s)]),a("  漏洞的影響，Nginx 必須升級到 1.20.1 以上。"),u,a(" 本次教學直接使用 nginx 官方的安裝指南，取代 ubuntu 官方發行的版本")]),g,n("p",null,[n("a",h,[a("http://nginx.org/en/linux_packages.html"),e(s)])])])}const f=i(l,[["render",b],["__file","index.html.vue"]]);export{f as default};
