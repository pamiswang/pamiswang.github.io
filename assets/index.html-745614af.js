import{_ as d}from"./plugin-vue_export-helper-c27b6911.js";import{r as t,o as i,c as l,a as e,b as s,e as n,f as r}from"./app-0ff84aa6.js";const o={},c=r(`<h1 id="確認條件" tabindex="-1"><a class="header-anchor" href="#確認條件" aria-hidden="true">#</a> 確認條件</h1><h2 id="確認-php-支持的-pdo-pgsql-版本" tabindex="-1"><a class="header-anchor" href="#確認-php-支持的-pdo-pgsql-版本" aria-hidden="true">#</a> 確認 PHP 支持的 <code>pdo_pgsql</code> 版本</h2><p>通過輸出 phpinfo() 函數，查看 PHP 對應的 pdo_pgsql 的版本，<br> 建議下載的 PostgreSQL 與 pdo_pgsql 版本不要相差太多<br> ![[pdo_pgsql_version.jpg]]</p><p>PostgreSQL 版本大於 10 的話，則 pdo_pgsql 版本也必須大於 10 。<br> scram-sha-256 是 PostgreSQL 10 中新增的基於 SASL 的認證方式，是 PostgreSQL 目前提供的最安全的認證方式。使用 scram-sha-256 認證方式不支持舊版本的客戶端庫。如果使用 PostgreSQL 10 以前的客戶端庫連接數據庫，會有如下錯誤：<br> SCRAM authentication requires libpq version 10 or above</p><h1 id="安裝-postgresql" tabindex="-1"><a class="header-anchor" href="#安裝-postgresql" aria-hidden="true">#</a> 安裝 PostgreSQL</h1><h2 id="安裝指令" tabindex="-1"><a class="header-anchor" href="#安裝指令" aria-hidden="true">#</a> 安裝指令</h2><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 建立軟體庫設定文件：</span>
<span class="token function">sudo</span> <span class="token function">sh</span> <span class="token parameter variable">-c</span> <span class="token string">&#39;echo &quot;deb http://apt.postgresql.org/pub/repos/apt $(lsb_release -cs)-pgdg main&quot; &gt; /etc/apt/sources.list.d/pgdg.list&#39;</span>

<span class="token comment"># 匯入軟體庫簽名密鑰：</span>
<span class="token function">wget</span> <span class="token parameter variable">--quiet</span> <span class="token parameter variable">-O</span> - https://www.postgresql.org/media/keys/ACCC4CF8.asc <span class="token operator">|</span> <span class="token function">sudo</span> apt-key <span class="token function">add</span> -

<span class="token comment"># 更新軟體列表：</span>
<span class="token function">sudo</span> <span class="token function">apt-get</span> update

<span class="token comment"># 安裝最新版本的PostgreSQL</span>
<span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> postgresql

<span class="token comment"># 可供安裝特定版本的PostgreSQL</span>
<span class="token function">sudo</span> <span class="token function">apt-cache</span> pkgnames postgresql

<span class="token comment"># 安裝特定版本的PostgreSQL</span>
<span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> postgresql-14
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,7),p={href:"https://www.postgresql.org/download/linux/ubuntu/",target:"_blank",rel:"noopener noreferrer"},h=r(`<h2 id="測試安裝是否成功" tabindex="-1"><a class="header-anchor" href="#測試安裝是否成功" aria-hidden="true">#</a> 測試安裝是否成功</h2><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">sudo</span> psql <span class="token parameter variable">--version</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h1 id="安裝-pgadmin-4-可選" tabindex="-1"><a class="header-anchor" href="#安裝-pgadmin-4-可選" aria-hidden="true">#</a> 安裝 pgAdmin 4 (可選)</h1><p>[[install_ubuntu_pgAdmin4]]</p><h1 id="觀念預備" tabindex="-1"><a class="header-anchor" href="#觀念預備" aria-hidden="true">#</a> 觀念預備</h1><p>[[guide_PostgreSQL]]</p><h1 id="初次設定" tabindex="-1"><a class="header-anchor" href="#初次設定" aria-hidden="true">#</a> 初次設定</h1><h2 id="以超級使用者身分使用預設的角色-postgres" tabindex="-1"><a class="header-anchor" href="#以超級使用者身分使用預設的角色-postgres" aria-hidden="true">#</a> 以超級使用者身分使用預設的角色 postgres</h2><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">su</span> - postgres
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>通常<code>postgres</code>用戶只會在本地被使用。</p><h2 id="進入psql-互動式終端機" tabindex="-1"><a class="header-anchor" href="#進入psql-互動式終端機" aria-hidden="true">#</a> 進入psql 互動式終端機</h2><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>psql
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="變更管理員密碼" tabindex="-1"><a class="header-anchor" href="#變更管理員密碼" aria-hidden="true">#</a> 變更管理員密碼</h2><p>確認該版本的加密方式</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">SHOW</span> password_encryption<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div>`,15),u=e("code",null,"md5",-1),g=e("code",null,"scram-sha-256",-1),b=e("code",null,"/etc/postgresql/14/main/postgresql.conf",-1),m=e("code",null,"password_encryption",-1),v=e("br",null,null,-1),_={href:"https://docs.postgresql.tw/server-administration/server-configuration/connections-and-authentication",target:"_blank",rel:"noopener noreferrer"},f=r(`<p>初始不用密碼就可以進入伺服器了，所以建議先改個密碼。</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">ALTER</span> <span class="token keyword">USER</span> postgres PASSWORD <span class="token string">&#39;password&#39;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div>`,2),k={href:"https://docs.postgresql.tw/reference/sql-commands/alter-user",target:"_blank",rel:"noopener noreferrer"},q=e("br",null,null,-1),x=r(`<div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>psql <span class="token parameter variable">-h</span> localhost <span class="token parameter variable">-U</span> postgres
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>如果看到下圖就是成功了<br> ![[postgres_password.jpg]]</p><h2 id="建立角色" tabindex="-1"><a class="header-anchor" href="#建立角色" aria-hidden="true">#</a> 建立角色</h2><h3 id="進入psql-互動式終端機-1" tabindex="-1"><a class="header-anchor" href="#進入psql-互動式終端機-1" aria-hidden="true">#</a> 進入psql 互動式終端機</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>psql
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="建立可登入的用戶" tabindex="-1"><a class="header-anchor" href="#建立可登入的用戶" aria-hidden="true">#</a> 建立可登入的用戶</h3><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token comment"># 使用別名並設定密碼</span>
<span class="token keyword">CREATE</span> <span class="token keyword">USER</span> name <span class="token keyword">WITH</span> PASSWORD <span class="token string">&#39;********&#39;</span><span class="token punctuation">;</span>
<span class="token comment"># 或使用新增角色指令並加入 LOGIN 參數</span>
<span class="token keyword">CREATE</span> ROLE name <span class="token keyword">WITH</span> LOGIN PASSWORD <span class="token string">&#39;********&#39;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>CREATE USER 現在是 CREATE ROLE 的別名指令。唯一的區別是當命令為 CREATE USER 時，預設情況下是具有 LOGIN 權限的，而當命令為 CREATE ROLE 時則預設為 NOLOGIN。</p><p>具有 LOGIN 屬性的角色可以被認為是一個使用者。沒有此屬性的角色對於管理資料庫權限很有用，但不是一般認知上的使用者。</p>`,9),E={href:"https://docs.postgresql.tw/reference/sql-commands/create-role",target:"_blank",rel:"noopener noreferrer"},w=e("br",null,null,-1),S={href:"https://docs.postgresql.tw/reference/sql-commands/create-user",target:"_blank",rel:"noopener noreferrer"},R=r(`<h3 id="設定用戶管理資料庫權限" tabindex="-1"><a class="header-anchor" href="#設定用戶管理資料庫權限" aria-hidden="true">#</a> 設定用戶管理資料庫權限</h3><p>賦予角色建立其他角色和新資料庫的能力</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">ALTER</span> <span class="token keyword">USER</span> <span class="token keyword">user</span> CREATEROLE CREATEDB<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div>`,3),L={href:"https://docs.postgresql.tw/reference/sql-commands/alter-user",target:"_blank",rel:"noopener noreferrer"},A=e("br",null,null,-1),P={href:"https://docs.postgresql.tw/reference/sql-commands/alter-role",target:"_blank",rel:"noopener noreferrer"},T=r(`<h3 id="列出用戶列表檢查是否修改成功" tabindex="-1"><a class="header-anchor" href="#列出用戶列表檢查是否修改成功" aria-hidden="true">#</a> 列出用戶列表檢查是否修改成功</h3><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code>postgres<span class="token operator">-</span><span class="token comment"># \\du+</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>之後用 pgAdmin管理工具來設定其他使用者權限比較方便</p><h2 id="設定遠端連線" tabindex="-1"><a class="header-anchor" href="#設定遠端連線" aria-hidden="true">#</a> 設定遠端連線</h2><h3 id="修改設定文件" tabindex="-1"><a class="header-anchor" href="#修改設定文件" aria-hidden="true">#</a> 修改設定文件</h3><p>預設情況下，PostgreSQL 伺服器只監聽本機位址：127.0.0.1。<br> 為了允許遠端連線<br> 打開設定文件<code>/etc/postgresql/14/main/postgresql.conf</code><br> 並且在<code>CONNECTIONS AND AUTHENTICATION</code>一節添加 <code>listen_addresses = &#39;*&#39;</code>後存檔。</p><h3 id="設定伺服器接受遠端連線" tabindex="-1"><a class="header-anchor" href="#設定伺服器接受遠端連線" aria-hidden="true">#</a> 設定伺服器接受遠端連線</h3><p>開啟 <code>/etc/postgresql/14/main/pg_hba.conf</code> 設定允許的連接方式</p><p>例如直接全開並使用 scram-sha-256 加密方式做驗證</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code># TYPE  DATABASE    USER       ADDRESS             METHOD
host    all         all        0.0.0.0/0           scram-sha-256
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div>`,10),O=e("br",null,null,-1),y={href:"https://docs.postgresql.tw/server-administration/client-authentication/the-pg_hba.conf-file",target:"_blank",rel:"noopener noreferrer"},C=r(`<h3 id="重新啟動服務" tabindex="-1"><a class="header-anchor" href="#重新啟動服務" aria-hidden="true">#</a> 重新啟動服務</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">service</span> postgresql restart
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h1 id="系統可用指令" tabindex="-1"><a class="header-anchor" href="#系統可用指令" aria-hidden="true">#</a> 系統可用指令</h1><h2 id="查看執行狀態" tabindex="-1"><a class="header-anchor" href="#查看執行狀態" aria-hidden="true">#</a> 查看執行狀態</h2><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">sudo</span> systemctl status postgresql
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="查看資料庫版本" tabindex="-1"><a class="header-anchor" href="#查看資料庫版本" aria-hidden="true">#</a> 查看資料庫版本</h2><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">sudo</span> psql <span class="token parameter variable">--version</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="以超級使用者身分使用-postgres" tabindex="-1"><a class="header-anchor" href="#以超級使用者身分使用-postgres" aria-hidden="true">#</a> 以超級使用者身分使用 postgres</h2><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">su</span> - postgres
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>使用後帳號名稱會變postgres，表示成功進入伺服器</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>postgres@computer-name:~$ 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="psql-—-postgresql-互動式終端機" tabindex="-1"><a class="header-anchor" href="#psql-—-postgresql-互動式終端機" aria-hidden="true">#</a> psql — PostgreSQL 互動式終端機</h2><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>postgres@computer-name:~$ psql
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h1 id="資料庫可用指令" tabindex="-1"><a class="header-anchor" href="#資料庫可用指令" aria-hidden="true">#</a> 資料庫可用指令</h1><h2 id="顯示伺服器的版本號碼" tabindex="-1"><a class="header-anchor" href="#顯示伺服器的版本號碼" aria-hidden="true">#</a> 顯示伺服器的版本號碼</h2><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">SHOW</span> SERVER_ENCODING<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div>`,16),N={href:"https://docs.postgresql.tw/reference/sql-commands/show",target:"_blank",rel:"noopener noreferrer"},Q=r(`<h2 id="查看用戶列表" tabindex="-1"><a class="header-anchor" href="#查看用戶列表" aria-hidden="true">#</a> 查看用戶列表</h2><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code>postgres<span class="token operator">-</span><span class="token comment"># \\du+</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="查看資料庫列表" tabindex="-1"><a class="header-anchor" href="#查看資料庫列表" aria-hidden="true">#</a> 查看資料庫列表</h2><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code>postgres<span class="token operator">-</span><span class="token comment"># \\l+</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="離開-psql-終端" tabindex="-1"><a class="header-anchor" href="#離開-psql-終端" aria-hidden="true">#</a> 離開 psql 終端</h2><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">exit</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h1 id="參考資料" tabindex="-1"><a class="header-anchor" href="#參考資料" aria-hidden="true">#</a> 參考資料</h1>`,7),I={href:"https://www.postgresql.org/download/linux/ubuntu/",target:"_blank",rel:"noopener noreferrer"},U=e("br",null,null,-1),D={href:"https://www.pgadmin.org/download/pgadmin-4-apt/",target:"_blank",rel:"noopener noreferrer"},H=e("br",null,null,-1),W={href:"https://www.postgresql.org/docs/14/index.html",target:"_blank",rel:"noopener noreferrer"},G=e("br",null,null,-1),B={href:"https://docs.postgresql.tw/",target:"_blank",rel:"noopener noreferrer"},V=e("br",null,null,-1),$={href:"https://learnku.com/articles/67688",target:"_blank",rel:"noopener noreferrer"},j=e("br",null,null,-1),z={href:"https://zhuanlan.zhihu.com/p/580030679",target:"_blank",rel:"noopener noreferrer"},M=e("h1",{id:"常見問題",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#常見問題","aria-hidden":"true"},"#"),s(" 常見問題")],-1),F={href:"https://dba.stackexchange.com/questions/40335/postgresql-cannot-change-directory-to-root",target:"_blank",rel:"noopener noreferrer"};function Y(J,K){const a=t("ExternalLinkIcon");return i(),l("div",null,[c,e("p",null,[s("實際指令以及對應版本可參考"),e("a",p,[s("PostgreSQL官方安裝教學"),n(a)])]),h,e("p",null,[s("舊版為"),u,s("，新版為"),g,s("，如果要變更設定可到"),b,s("調整"),m,v,e("a",_,[s("20.3. 連線與認證"),n(a)])]),f,e("p",null,[e("a",k,[s("ALTER USER — 變更資料庫角色屬性"),n(a)]),q,s(" 以普通使用者連線伺服器")]),x,e("p",null,[e("a",E,[s("CREATE ROLE — 定義一個新的資料庫角色"),n(a)]),w,e("a",S,[s("CREATE USER — 定義一個新的資料庫角色"),n(a)])]),R,e("p",null,[e("a",L,[s("ALTER USER — 變更資料庫角色屬性"),n(a)]),A,e("a",P,[s("ALTER ROLE — 變更資料庫角色"),n(a)])]),T,e("p",null,[s("實際在正式環境詳細設定請參照官方的文件"),O,e("a",y,[s("21.1. 設定檔：pg_hba.conf"),n(a)])]),C,e("p",null,[e("a",N,[s("SHOW — 顯示執行時期參數的值"),n(a)])]),Q,e("p",null,[e("a",I,[s("PostgreSQL官方安裝教學"),n(a)]),U,e("a",D,[s("pgAdmin官方安裝教學"),n(a)]),H,e("a",W,[s("PostgreSQL 14.7 Documentation"),n(a)]),G,e("a",B,[s("PostgreSQL正體中文使用手冊"),n(a)]),V,e("a",$,[s("https://learnku.com/articles/67688"),n(a)]),j,e("a",z,[s("Ubuntu-22.04安装Postgresql"),n(a)])]),M,e("p",null,[e("a",F,[s('could not change directory to "/root": Permission denied'),n(a)])])])}const ee=d(o,[["render",Y],["__file","index.html.vue"]]);export{ee as default};
